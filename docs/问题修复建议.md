# ä¸‡å‰‘å½’å®— - é—®é¢˜ä¿®å¤å»ºè®®

## ğŸš¨ é«˜ä¼˜å…ˆçº§é—®é¢˜ (å¿…é¡»ä¿®å¤)

### 1. iOSç‰ˆæœ¬è¦æ±‚è¿‡é«˜
**é—®é¢˜**: å½“å‰è¦æ±‚iOS 26.2ï¼Œè¿™ä¸ªç‰ˆæœ¬ä¸å­˜åœ¨
```swift
// wjgz.xcodeproj/project.pbxproj
IPHONEOS_DEPLOYMENT_TARGET = 26.2;  // âŒ é”™è¯¯ç‰ˆæœ¬
```

**ä¿®å¤æ–¹æ¡ˆ**:
```swift
// å»ºè®®ä¿®æ”¹ä¸º
IPHONEOS_DEPLOYMENT_TARGET = 13.0;  // âœ… æ”¯æŒæ›´å¤šè®¾å¤‡
```

**å½±å“**: ç‰ˆæœ¬å·é”™è¯¯ä¼šå¯¼è‡´æ— æ³•ä¸Šæ¶App Store

---

### 2. ç‰¹æ•ˆæ€§èƒ½ä¼˜åŒ–
**é—®é¢˜**: ä¸‡å‰‘å½’å®—ç‰¹æ•ˆåŒæ—¶åˆ›å»º50ä¸ªé£å‰‘ï¼Œå¯èƒ½å¯¼è‡´å¸§ç‡ä¸‹é™
```swift
// EffectsManager.swift - ç¬¬1020è¡Œ
for i in 0..<50 {  // âŒ å¯èƒ½é€ æˆæ€§èƒ½é—®é¢˜
    let sword = createFlyingSword()
    // ...
}
```

**ä¿®å¤æ–¹æ¡ˆ**:
```swift
// åˆ†æ‰¹åˆ›å»ºï¼Œé¿å…å¸§ç‡éª¤é™
private func createSwordsInBatches(totalCount: Int) {
    let batchSize = 5
    let batchDelay = 0.05
    
    for batch in 0..<(totalCount / batchSize) {
        let delay = Double(batch) * batchDelay
        run(SKAction.sequence([
            SKAction.wait(forDuration: delay),
            SKAction.run { [weak self] in
                for _ in 0..<batchSize {
                    self?.createFlyingSword()
                }
            }
        ]))
    }
}

// ä½¿ç”¨æ–¹æ³•
createSwordsInBatches(totalCount: 50)
```

---

### 3. éŸ³æ•ˆæ–‡ä»¶ç¼ºå¤±å¤„ç†
**é—®é¢˜**: éŸ³æ•ˆæ–‡ä»¶å¯èƒ½æœªæ­£ç¡®æ·»åŠ åˆ°é¡¹ç›®Bundleä¸­
```swift
// SoundManager.swift - ç¬¬85è¡Œ
if let url = Bundle.main.url(forResource: basePath, withExtension: ext) {
    // å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œä¼šé™é»˜å¤±è´¥
}
```

**ä¿®å¤æ–¹æ¡ˆ**:
```swift
// å¢åŠ éŸ³æ•ˆæ–‡ä»¶æ£€æŸ¥å’Œç”¨æˆ·æç¤º
private func validateSoundFiles() {
    let requiredSounds = [
        "sword_whoosh", "sword_clash", "merge_small", 
        "button_click", "success", "combo"
    ]
    
    var missingSounds: [String] = []
    
    for sound in requiredSounds {
        if loadSound(sound) == nil {
            missingSounds.append(sound)
        }
    }
    
    if !missingSounds.isEmpty {
        print("âš ï¸ ç¼ºå¤±éŸ³æ•ˆæ–‡ä»¶: \(missingSounds.joined(separator: ", "))")
        // åœ¨å¼€å‘æ¨¡å¼ä¸‹æ˜¾ç¤ºè­¦å‘Š
        #if DEBUG
        showMissingSoundAlert(missingSounds)
        #endif
    }
}

#if DEBUG
private func showMissingSoundAlert(_ missingSounds: [String]) {
    // æ˜¾ç¤ºå¼€å‘è€…è­¦å‘Š
    DispatchQueue.main.async {
        // å¯ä»¥æ·»åŠ UIAlertControlleræç¤ºå¼€å‘è€…
    }
}
#endif
```

---

## âš ï¸ ä¸­ä¼˜å…ˆçº§é—®é¢˜ (å»ºè®®ä¿®å¤)

### 4. æ–°æ‰‹æ•™ç¨‹è¿‡äºç®€å•
**é—®é¢˜**: å½“å‰æ•™ç¨‹åªæœ‰4æ¡ç®€å•æç¤ºï¼Œæ–°ç”¨æˆ·å¯èƒ½ä¸ç†è§£æ¸¸æˆæœºåˆ¶
```swift
// GameScene.swift - ç¬¬2150è¡Œ
let messages = [
    ("æ¬¢è¿æ¥åˆ°å‰‘é˜µ", "ç‚¹å‡»ç›¸åŒçš„é£å‰‘è¿›è¡Œåˆæˆ"),
    ("ä¸‰å‰‘å½’ä¸€", "é€‰æ‹©3æŠŠç›¸åŒçš„å‰‘ï¼Œå®ƒä»¬å°†åˆæˆæ›´å¼ºçš„å‰‘"),
    ("ç§¯è“„å‰‘æ„", "æ¯æ¬¡åˆæˆéƒ½ä¼šç§¯ç´¯å‰‘æ„èƒ½é‡"),
    ("ä¸‡å‰‘å½’å®—", "èƒ½é‡æ»¡æ—¶å¯é‡Šæ”¾ç»ˆææŠ€"),
]
```

**ä¿®å¤æ–¹æ¡ˆ**:
```swift
// å¢åŠ äº¤äº’å¼æ•™ç¨‹
private func showInteractiveTutorial() {
    let tutorialSteps = [
        TutorialStep(
            title: "æ¬¢è¿æ¥åˆ°ä¸‡å‰‘å½’å®—",
            description: "è¿™æ˜¯ä¸€ä¸ªå‰‘ä¿®ä¸»é¢˜çš„åˆæˆæ¸¸æˆ",
            action: .showHighlight(targetNode: nil),
            condition: .tapAnywhere
        ),
        TutorialStep(
            title: "æ‹–åŠ¨é£å‰‘",
            description: "ç”¨æ‰‹æŒ‡æ‹–åŠ¨é£å‰‘åˆ°ç›¸é‚»ä½ç½®",
            action: .highlightSwords(type: .fan),
            condition: .dragSword
        ),
        TutorialStep(
            title: "ä¸‰å‰‘åˆä¸€",
            description: "å°†3æŠŠç›¸åŒçš„å‰‘æ”¾åœ¨ä¸€èµ·è‡ªåŠ¨åˆæˆ",
            action: .showMergeAnimation,
            condition: .completeMerge
        ),
        // æ›´å¤šæ­¥éª¤...
    ]
    
    startTutorialSequence(steps: tutorialSteps)
}

struct TutorialStep {
    let title: String
    let description: String
    let action: TutorialAction
    let condition: TutorialCondition
}

enum TutorialAction {
    case showHighlight(targetNode: SKNode?)
    case highlightSwords(type: SwordType)
    case showMergeAnimation
    case showEnergyBar
}

enum TutorialCondition {
    case tapAnywhere
    case dragSword
    case completeMerge
    case energyFull
}
```

---

### 5. é”™è¯¯å¤„ç†æœºåˆ¶ä¸å®Œå–„
**é—®é¢˜**: ç¼ºå°‘å¯¹æ¸¸æˆçŠ¶æ€é”™è¯¯ã€å­˜æ¡£æŸåç­‰å¼‚å¸¸æƒ…å†µçš„å¤„ç†

**ä¿®å¤æ–¹æ¡ˆ**:
```swift
// å¢åŠ é”™è¯¯å¤„ç†æšä¸¾
enum GameError: Error {
    case saveDataCorrupted
    case levelDataMissing
    case audioSystemFailure
    case memoryWarning
    
    var localizedDescription: String {
        switch self {
        case .saveDataCorrupted:
            return "å­˜æ¡£æ•°æ®æŸåï¼Œå°†é‡ç½®æ¸¸æˆè¿›åº¦"
        case .levelDataMissing:
            return "å…³å¡æ•°æ®ç¼ºå¤±ï¼Œè¯·é‡æ–°å®‰è£…æ¸¸æˆ"
        case .audioSystemFailure:
            return "éŸ³æ•ˆç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥ï¼Œæ¸¸æˆå°†ä»¥é™éŸ³æ¨¡å¼è¿è¡Œ"
        case .memoryWarning:
            return "å†…å­˜ä¸è¶³ï¼Œå»ºè®®å…³é—­å…¶ä»–åº”ç”¨"
        }
    }
}

// é”™è¯¯å¤„ç†ç®¡ç†å™¨
class ErrorHandler {
    static let shared = ErrorHandler()
    
    func handle(_ error: GameError) {
        print("ğŸš¨ æ¸¸æˆé”™è¯¯: \(error.localizedDescription)")
        
        switch error {
        case .saveDataCorrupted:
            resetGameData()
            showUserAlert(message: error.localizedDescription)
        case .levelDataMissing:
            // å°è¯•é‡æ–°åŠ è½½å…³å¡æ•°æ®
            reloadLevelData()
        case .audioSystemFailure:
            // ç¦ç”¨éŸ³æ•ˆï¼Œç»§ç»­æ¸¸æˆ
            SoundManager.shared.setEnabled(false)
        case .memoryWarning:
            // æ¸…ç†ç¼“å­˜ï¼Œå‡å°‘å†…å­˜ä½¿ç”¨
            clearMemoryCache()
        }
    }
    
    private func showUserAlert(message: String) {
        // æ˜¾ç¤ºç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º
        DispatchQueue.main.async {
            // å®ç°ç”¨æˆ·æç¤ºç•Œé¢
        }
    }
}
```

---

### 6. å†…å­˜ä¼˜åŒ–
**é—®é¢˜**: ç‰¹æ•ˆç²’å­å¯èƒ½ç´¯ç§¯è¿‡å¤šï¼Œå½±å“å†…å­˜ä½¿ç”¨

**ä¿®å¤æ–¹æ¡ˆ**:
```swift
// ç²’å­å¯¹è±¡æ± ç®¡ç†
class ParticlePool {
    static let shared = ParticlePool()
    
    private var particlePool: [String: [SKNode]] = [:]
    private let maxPoolSize = 20
    private var activeParticles = 0
    private let maxActiveParticles = 50
    
    func getParticle(type: String) -> SKNode? {
        guard activeParticles < maxActiveParticles else {
            return nil // è¾¾åˆ°æœ€å¤§æ•°é‡é™åˆ¶
        }
        
        if let pool = particlePool[type], !pool.isEmpty {
            let particle = pool.removeLast()
            activeParticles += 1
            return particle
        }
        
        // åˆ›å»ºæ–°ç²’å­
        let particle = createNewParticle(type: type)
        activeParticles += 1
        return particle
    }
    
    func returnParticle(_ particle: SKNode, type: String) {
        particle.removeAllActions()
        particle.alpha = 1.0
        particle.setScale(1.0)
        
        if particlePool[type] == nil {
            particlePool[type] = []
        }
        
        if particlePool[type]!.count < maxPoolSize {
            particlePool[type]!.append(particle)
        }
        
        activeParticles = max(0, activeParticles - 1)
    }
    
    private func createNewParticle(type: String) -> SKNode {
        switch type {
        case "sword":
            return createSwordParticle()
        case "explosion":
            return createExplosionParticle()
        default:
            return SKShapeNode(circleOfRadius: 5)
        }
    }
}

// åœ¨EffectsManagerä¸­ä½¿ç”¨å¯¹è±¡æ± 
func playMergeBurst(at position: CGPoint, color: UIColor, count: Int = 12, swordType: SwordType? = nil) {
    let actualCount = min(count, 20) // é™åˆ¶ç²’å­æ•°é‡
    
    for i in 0..<actualCount {
        guard let particle = ParticlePool.shared.getParticle(type: "merge") else {
            break // è¾¾åˆ°é™åˆ¶ï¼Œåœæ­¢åˆ›å»º
        }
        
        // è®¾ç½®ç²’å­å±æ€§...
        
        // åŠ¨ç”»å®Œæˆåè¿”å›å¯¹è±¡æ± 
        particle.run(SKAction.sequence([
            // åŠ¨ç”»...
            SKAction.run { [weak self] in
                ParticlePool.shared.returnParticle(particle, type: "merge")
            },
            SKAction.removeFromParent()
        ]))
    }
}
```

---

## ğŸ’¡ ä½ä¼˜å…ˆçº§æ”¹è¿› (å¯é€‰)

### 7. å¤šè¯­è¨€æ”¯æŒ
**å»ºè®®**: æ·»åŠ è‹±æ–‡æœ¬åœ°åŒ–æ”¯æŒï¼Œæ‰©å¤§ç”¨æˆ·ç¾¤ä½“

```swift
// åˆ›å»ºLocalizable.stringsæ–‡ä»¶
// en.lproj/Localizable.strings
"game_title" = "Sword Formation";
"level_complete" = "Level Complete";
"ultimate_skill" = "Ultimate Skill";

// zh-Hans.lproj/Localizable.strings  
"game_title" = "ä¸‡å‰‘å½’å®—";
"level_complete" = "å…³å¡å®Œæˆ";
"ultimate_skill" = "ä¸‡å‰‘å½’å®—";

// ä½¿ç”¨æœ¬åœ°åŒ–å­—ç¬¦ä¸²
let titleText = NSLocalizedString("game_title", comment: "æ¸¸æˆæ ‡é¢˜")
```

### 8. æ— éšœç¢åŠŸèƒ½æ”¯æŒ
**å»ºè®®**: æ·»åŠ VoiceOveræ”¯æŒï¼Œæé«˜å¯è®¿é—®æ€§

```swift
// ä¸ºæ¸¸æˆå…ƒç´ æ·»åŠ æ— éšœç¢æ ‡ç­¾
private func setupAccessibility() {
    scoreLabel.isAccessibilityElement = true
    scoreLabel.accessibilityLabel = "å½“å‰åˆ†æ•°"
    scoreLabel.accessibilityValue = "\(score)åˆ†"
    
    ultimateButton.isAccessibilityElement = true
    ultimateButton.accessibilityLabel = "ä¸‡å‰‘å½’å®—æŠ€èƒ½"
    ultimateButton.accessibilityHint = "åŒå‡»é‡Šæ”¾ç»ˆææŠ€èƒ½"
    
    // ä¸ºå‰‘æ·»åŠ æ— éšœç¢ä¿¡æ¯
    for sword in grid.values {
        sword.isAccessibilityElement = true
        sword.accessibilityLabel = "\(sword.type.fullName)"
        sword.accessibilityHint = "å¯æ‹–åŠ¨è¿›è¡Œåˆæˆ"
    }
}
```

### 9. æ€§èƒ½ç›‘æ§
**å»ºè®®**: æ·»åŠ æ€§èƒ½ç›‘æ§ï¼Œä¾¿äºä¼˜åŒ–

```swift
// æ€§èƒ½ç›‘æ§ç®¡ç†å™¨
class PerformanceMonitor {
    static let shared = PerformanceMonitor()
    
    private var frameCount = 0
    private var lastTime: TimeInterval = 0
    private var fps: Double = 0
    
    func update(currentTime: TimeInterval) {
        frameCount += 1
        
        if currentTime - lastTime >= 1.0 {
            fps = Double(frameCount) / (currentTime - lastTime)
            frameCount = 0
            lastTime = currentTime
            
            // æ€§èƒ½è­¦å‘Š
            if fps < 30 {
                print("âš ï¸ æ€§èƒ½è­¦å‘Š: FPS = \(fps)")
                // å¯ä»¥è§¦å‘æ€§èƒ½ä¼˜åŒ–æªæ–½
                optimizePerformance()
            }
        }
    }
    
    private func optimizePerformance() {
        // å‡å°‘ç‰¹æ•ˆæ•°é‡
        EffectsManager.shared.reduceEffectQuality()
        
        // æ¸…ç†ä¸å¿…è¦çš„èŠ‚ç‚¹
        cleanupNodes()
        
        // é™ä½ç²’å­æ•°é‡
        ParticlePool.shared.reduceMaxParticles()
    }
}
```

---

## ğŸ“‹ ä¿®å¤ä¼˜å…ˆçº§æ€»ç»“

### ç«‹å³ä¿®å¤ (ä¸Šæ¶å‰å¿…é¡»)
1. âœ… **iOSç‰ˆæœ¬å·ä¿®æ­£** - 5åˆ†é’Ÿ
2. âœ… **ç‰¹æ•ˆæ€§èƒ½ä¼˜åŒ–** - 2å°æ—¶
3. âœ… **éŸ³æ•ˆæ–‡ä»¶æ£€æŸ¥** - 1å°æ—¶

### çŸ­æœŸä¿®å¤ (1-2å‘¨å†…)
4. âœ… **æ–°æ‰‹æ•™ç¨‹æ”¹è¿›** - 1å¤©
5. âœ… **é”™è¯¯å¤„ç†å®Œå–„** - 4å°æ—¶
6. âœ… **å†…å­˜ä¼˜åŒ–** - 6å°æ—¶

### é•¿æœŸæ”¹è¿› (åç»­ç‰ˆæœ¬)
7. ğŸ”„ **å¤šè¯­è¨€æ”¯æŒ** - 2-3å¤©
8. ğŸ”„ **æ— éšœç¢åŠŸèƒ½** - 1-2å¤©
9. ğŸ”„ **æ€§èƒ½ç›‘æ§** - 1å¤©

---

## ğŸ› ï¸ å…·ä½“å®æ–½æ­¥éª¤

### ç¬¬ä¸€é˜¶æ®µï¼šç´§æ€¥ä¿®å¤ (ä»Šå¤©å®Œæˆ)
```bash
# 1. ä¿®æ”¹iOSç‰ˆæœ¬è¦æ±‚
# åœ¨Xcodeä¸­ï¼šProject Settings â†’ Deployment Target â†’ 13.0

# 2. ç‰¹æ•ˆä¼˜åŒ–
# ä¿®æ”¹ EffectsManager.swift ä¸­çš„ä¸‡å‰‘å½’å®—ç‰¹æ•ˆ

# 3. éŸ³æ•ˆæ£€æŸ¥
# ç¡®ä¿æ‰€æœ‰éŸ³æ•ˆæ–‡ä»¶åœ¨ Copy Bundle Resources ä¸­
```

### ç¬¬äºŒé˜¶æ®µï¼šåŠŸèƒ½å®Œå–„ (æœ¬å‘¨å®Œæˆ)
```bash
# 1. æ–°æ‰‹æ•™ç¨‹
# åˆ›å»º TutorialManager.swift
# å®ç°äº¤äº’å¼å¼•å¯¼

# 2. é”™è¯¯å¤„ç†
# åˆ›å»º ErrorHandler.swift
# æ·»åŠ å¼‚å¸¸æƒ…å†µå¤„ç†

# 3. å†…å­˜ä¼˜åŒ–
# åˆ›å»º ParticlePool.swift
# å®ç°å¯¹è±¡æ± ç®¡ç†
```

### ç¬¬ä¸‰é˜¶æ®µï¼šä½“éªŒä¼˜åŒ– (ä¸‹ä¸ªç‰ˆæœ¬)
```bash
# 1. å¤šè¯­è¨€
# åˆ›å»º Localizable.strings
# å›½é™…åŒ–æ‰€æœ‰æ–‡æœ¬

# 2. æ— éšœç¢
# æ·»åŠ  VoiceOver æ”¯æŒ
# ä¼˜åŒ–æ“ä½œä½“éªŒ

# 3. ç›‘æ§
# é›†æˆæ€§èƒ½ç›‘æ§
# æ·»åŠ å´©æºƒæŠ¥å‘Š
```

---

## âœ… ä¿®å¤éªŒè¯æ¸…å•

### ä¿®å¤å®Œæˆåæ£€æŸ¥é¡¹ç›®
- [ ] iOSç‰ˆæœ¬è®¾ç½®ä¸º13.0æˆ–æ›´é«˜çš„åˆç†ç‰ˆæœ¬
- [ ] ä¸‡å‰‘å½’å®—ç‰¹æ•ˆä¸ä¼šå¯¼è‡´æ˜æ˜¾å¡é¡¿
- [ ] æ‰€æœ‰éŸ³æ•ˆæ–‡ä»¶æ­£ç¡®åŠ è½½ï¼Œæœ‰fallbackæœºåˆ¶
- [ ] æ–°æ‰‹æ•™ç¨‹èƒ½å¼•å¯¼ç”¨æˆ·å®Œæˆç¬¬ä¸€æ¬¡åˆæˆ
- [ ] æ¸¸æˆå¼‚å¸¸æ—¶æœ‰å‹å¥½çš„é”™è¯¯æç¤º
- [ ] é•¿æ—¶é—´æ¸¸æˆå†…å­˜ä½¿ç”¨ç¨³å®š
- [ ] åœ¨çœŸæœºä¸Šæµ‹è¯•æ€§èƒ½è¡¨ç°
- [ ] ç¡®è®¤æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ

**å®Œæˆè¿™äº›ä¿®å¤åï¼Œæ¸¸æˆå°†å…·å¤‡ä¼˜ç§€çš„App Storeä¸Šæ¶æ¡ä»¶ï¼** ğŸš€