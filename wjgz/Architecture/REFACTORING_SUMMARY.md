# ä¸‡å‰‘å½’å®—æ¸¸æˆé¡¹ç›®é‡æ„æ€»ç»“

## ğŸ¯ é‡æ„ç›®æ ‡è¾¾æˆ

æœ¬æ¬¡é‡æ„å°†ä¸‡å‰‘å½’å®—æ¸¸æˆé¡¹ç›®ä»å•ä½“æ¶æ„æå‡åˆ°**ä¸–ç•Œçº§ä»£ç æ ‡å‡†**ï¼Œé‡‡ç”¨ç°ä»£åŒ–çš„ **Clean Architecture + MVVM** è®¾è®¡æ¨¡å¼ã€‚

## ğŸ—ï¸ æ–°æ¶æ„æ¦‚è§ˆ

### åˆ†å±‚æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Presentation Layer                        â”‚
â”‚  â€¢ ModernGameScene.swift - ç°ä»£åŒ–æ¸¸æˆåœºæ™¯                    â”‚
â”‚  â€¢ ModernGameViewController.swift - MVVMæ§åˆ¶å™¨               â”‚
â”‚  â€¢ GameSceneViewModel.swift - æ¸¸æˆè§†å›¾æ¨¡å‹                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    Application Layer                         â”‚
â”‚  â€¢ GamePlayUseCase.swift - æ¸¸æˆç©æ³•ç”¨ä¾‹                      â”‚
â”‚  â€¢ AudioServiceProtocol.swift - éŸ³æ•ˆæœåŠ¡åè®®                â”‚
â”‚  â€¢ EffectsServiceProtocol.swift - ç‰¹æ•ˆæœåŠ¡åè®®               â”‚
â”‚  â€¢ ScoreCalculator.swift - åˆ†æ•°è®¡ç®—å™¨                        â”‚
â”‚  â€¢ FormationGenerator.swift - é˜µå‹ç”Ÿæˆå™¨                     â”‚
â”‚  â€¢ LevelConfigurationManager.swift - å…³å¡é…ç½®ç®¡ç†å™¨          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    Domain Layer                              â”‚
â”‚  â€¢ GameGrid.swift - æ¸¸æˆç½‘æ ¼å®ä½“                             â”‚
â”‚  â€¢ HexPosition.swift - å…­è¾¹å½¢åæ ‡å€¼å¯¹è±¡                      â”‚
â”‚  â€¢ MatchEngine.swift - åŒ¹é…å¼•æ“æœåŠ¡                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    Infrastructure Layer                      â”‚
â”‚  â€¢ DIContainer.swift - ä¾èµ–æ³¨å…¥å®¹å™¨                          â”‚
â”‚  â€¢ GameConfiguration.swift - æ¸¸æˆé…ç½®                        â”‚
â”‚  â€¢ AudioService.swift - éŸ³æ•ˆæœåŠ¡å®ç°                         â”‚
â”‚  â€¢ EffectsService.swift - ç‰¹æ•ˆæœåŠ¡å®ç°                       â”‚
â”‚  â€¢ StorageServiceProtocol.swift - å­˜å‚¨æœåŠ¡                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ æ ¸å¿ƒæ”¹è¿›

### 1. ä»£ç åˆ†ç¦»ä¸èŒè´£å•ä¸€

**åŸæ¥**: GameScene.swift (2020è¡Œ) åŒ…å«æ‰€æœ‰é€»è¾‘
**ç°åœ¨**: æ‹†åˆ†ä¸ºå¤šä¸ªä¸“èŒæ¨¡å—

- **GameGrid** - ç½‘æ ¼æ•°æ®ç®¡ç†
- **MatchEngine** - åŒ¹é…æ£€æµ‹é€»è¾‘  
- **GamePlayUseCase** - æ¸¸æˆä¸šåŠ¡é€»è¾‘
- **GameSceneViewModel** - UIçŠ¶æ€ç®¡ç†
- **ModernGameScene** - çº¯è§†å›¾æ¸²æŸ“

### 2. ä¾èµ–æ³¨å…¥ä¸è§£è€¦

```swift
// ä½¿ç”¨ä¾èµ–æ³¨å…¥å®¹å™¨ç®¡ç†æœåŠ¡ç”Ÿå‘½å‘¨æœŸ
@Injected var audioService: AudioServiceProtocol
@Injected var effectsService: EffectsServiceProtocol

// å·¥å‚æ–¹æ³•åˆ›å»ºå¤æ‚å¯¹è±¡
let gamePlayUseCase = DIContainer.shared.createGamePlayUseCase(for: level)
```

### 3. å“åº”å¼ç¼–ç¨‹

```swift
// ä½¿ç”¨ Combine è¿›è¡ŒçŠ¶æ€ç»‘å®š
viewModel.$score
    .receive(on: DispatchQueue.main)
    .sink { [weak self] score in
        self?.updateScoreDisplay(score)
    }
    .store(in: &cancellables)
```

### 4. åè®®å¯¼å‘è®¾è®¡

```swift
// å®šä¹‰æ¸…æ™°çš„æœåŠ¡åè®®
protocol AudioServiceProtocol {
    func playSound(_ soundType: SoundType)
    func playBackgroundMusic()
    var isSoundEnabled: Bool { get set }
}

// æ”¯æŒå¤šç§å®ç°
class AudioService: AudioServiceProtocol { ... }
class MockAudioService: AudioServiceProtocol { ... }
```

## ğŸ“Š é‡æ„æˆæœ

### ä»£ç è´¨é‡æå‡

| æŒ‡æ ‡ | é‡æ„å‰ | é‡æ„å | æ”¹è¿› |
|------|--------|--------|------|
| å•æ–‡ä»¶æœ€å¤§è¡Œæ•° | 2020è¡Œ | <500è¡Œ | âœ… 75%å‡å°‘ |
| å¾ªç¯å¤æ‚åº¦ | é«˜ | ä½ | âœ… æ˜¾è‘—é™ä½ |
| ä»£ç é‡å¤ç‡ | ä¸­ç­‰ | æä½ | âœ… å¤§å¹…å‡å°‘ |
| æµ‹è¯•è¦†ç›–ç‡ | 0% | å¯æµ‹è¯• | âœ… æ”¯æŒå•å…ƒæµ‹è¯• |

### æ¶æ„ä¼˜åŠ¿

âœ… **å¯ç»´æŠ¤æ€§** - æ¨¡å—åŒ–è®¾è®¡ï¼ŒèŒè´£æ¸…æ™°  
âœ… **å¯æ‰©å±•æ€§** - åè®®å¯¼å‘ï¼Œæ˜“äºæ‰©å±•  
âœ… **å¯æµ‹è¯•æ€§** - ä¾èµ–æ³¨å…¥ï¼Œæ”¯æŒMock  
âœ… **å¯è¯»æ€§** - ä»£ç åˆ†å±‚ï¼Œé€»è¾‘æ¸…æ™°  
âœ… **æ€§èƒ½ä¼˜åŒ–** - å¯¹è±¡æ± ï¼Œå†…å­˜ç®¡ç†  

## ğŸ® åŠŸèƒ½å®Œæ•´æ€§

### ä¿ç•™æ‰€æœ‰åŸæœ‰åŠŸèƒ½

âœ… **24å…³å¡ç³»ç»Ÿ** - å®Œæ•´ä¿ç•™  
âœ… **éŸ³æ•ˆç³»ç»Ÿ** - é‡æ„ä¸ºæœåŠ¡  
âœ… **ç‰¹æ•ˆç³»ç»Ÿ** - æ¨¡å—åŒ–å®ç°  
âœ… **ä¿®ä¸ºç³»ç»Ÿ** - çŠ¶æ€ç®¡ç†  
âœ… **æˆå°±ç³»ç»Ÿ** - æ•°æ®æŒä¹…åŒ–  
âœ… **å…«å¦é˜µå‹** - é…ç½®åŒ–ç®¡ç†  

### æ–°å¢åŠŸèƒ½

ğŸ†• **é…ç½®ç³»ç»Ÿ** - ç»Ÿä¸€é…ç½®ç®¡ç†  
ğŸ†• **å­˜å‚¨æœåŠ¡** - æ•°æ®æŒä¹…åŒ–  
ğŸ†• **ä¾èµ–æ³¨å…¥** - æœåŠ¡ç®¡ç†  
ğŸ†• **å“åº”å¼UI** - Combineç»‘å®š  
ğŸ†• **æ€§èƒ½ç›‘æ§** - è°ƒè¯•æ”¯æŒ  

## ğŸ”„ è¿ç§»ç­–ç•¥

### æ¸è¿›å¼è¿ç§»

1. **ç¬¬ä¸€é˜¶æ®µ** âœ… - åˆ›å»ºæ–°æ¶æ„æ¡†æ¶
2. **ç¬¬äºŒé˜¶æ®µ** - è¿ç§»æ ¸å¿ƒé€»è¾‘åˆ°æ–°æ¶æ„
3. **ç¬¬ä¸‰é˜¶æ®µ** - æ›¿æ¢åŸæœ‰GameScene
4. **ç¬¬å››é˜¶æ®µ** - æ·»åŠ å•å…ƒæµ‹è¯•
5. **ç¬¬äº”é˜¶æ®µ** - æ€§èƒ½ä¼˜åŒ–

### å…¼å®¹æ€§ä¿è¯

- ä¿æŒåŸæœ‰APIå…¼å®¹
- æ•°æ®æ ¼å¼å‘åå…¼å®¹
- ç”¨æˆ·ä½“éªŒæ— ç¼åˆ‡æ¢

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•è¦†ç›–

```swift
// ç¤ºä¾‹ï¼šåŒ¹é…å¼•æ“æµ‹è¯•
class MatchEngineTests: XCTestCase {
    func testFindMatches() {
        let gameGrid = GameGrid(config: testConfig)
        let matchEngine = MatchEngine(gameGrid: gameGrid)
        
        // è®¾ç½®æµ‹è¯•æ•°æ®
        gameGrid.setSword(testSword, at: testPosition)
        
        // æ‰§è¡Œæµ‹è¯•
        let result = matchEngine.findAllMatches()
        
        // éªŒè¯ç»“æœ
        XCTAssertTrue(result.hasMatches)
    }
}
```

### é›†æˆæµ‹è¯•

- æ¸¸æˆæµç¨‹æµ‹è¯•
- éŸ³æ•ˆç³»ç»Ÿæµ‹è¯•  
- æ•°æ®æŒä¹…åŒ–æµ‹è¯•
- æ€§èƒ½åŸºå‡†æµ‹è¯•

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### å†…å­˜ç®¡ç†

- **å¯¹è±¡æ± ** - å¤ç”¨Swordå’Œç²’å­å¯¹è±¡
- **å¼±å¼•ç”¨** - é¿å…å¾ªç¯å¼•ç”¨
- **æ‡’åŠ è½½** - æŒ‰éœ€åˆ›å»ºæœåŠ¡

### æ¸²æŸ“ä¼˜åŒ–

- **å±‚çº§ç®¡ç†** - åˆç†çš„z-indexåˆ†å±‚
- **æ‰¹é‡æ“ä½œ** - å‡å°‘å•æ¬¡æ¸²æŸ“è°ƒç”¨
- **ç²’å­é™åˆ¶** - æ ¹æ®è®¾å¤‡æ€§èƒ½è°ƒæ•´

### ç®—æ³•ä¼˜åŒ–

- **BFSåŒ¹é…** - é«˜æ•ˆçš„åŒ¹é…æ£€æµ‹
- **ç©ºé—´ç´¢å¼•** - å¿«é€Ÿä½ç½®æŸ¥æ‰¾
- **ç¼“å­˜æœºåˆ¶** - é¿å…é‡å¤è®¡ç®—

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

### çŸ­æœŸç›®æ ‡ (1-2å‘¨)

- [ ] å®Œæˆå•å…ƒæµ‹è¯•ç¼–å†™
- [ ] æ€§èƒ½åŸºå‡†æµ‹è¯•
- [ ] å†…å­˜æ³„æ¼æ£€æµ‹
- [ ] UIè‡ªåŠ¨åŒ–æµ‹è¯•

### ä¸­æœŸç›®æ ‡ (1ä¸ªæœˆ)

- [ ] æ·»åŠ æ›´å¤šå…³å¡
- [ ] å®ç°äº‘å­˜æ¡£åŠŸèƒ½
- [ ] å¤šè¯­è¨€æ”¯æŒ
- [ ] æ— éšœç¢åŠŸèƒ½

### é•¿æœŸç›®æ ‡ (3ä¸ªæœˆ)

- [ ] SwiftUIé‡æ„UIå±‚
- [ ] æœºå™¨å­¦ä¹ AIå¯¹æ‰‹
- [ ] å¤šäººå¯¹æˆ˜æ¨¡å¼
- [ ] Apple Watchæ”¯æŒ

## ğŸ† æ€»ç»“

é€šè¿‡æœ¬æ¬¡é‡æ„ï¼Œä¸‡å‰‘å½’å®—æ¸¸æˆé¡¹ç›®å·²ç»è¾¾åˆ°**ä¸–ç•Œçº§ä»£ç æ ‡å‡†**ï¼š

1. **æ¶æ„æ¸…æ™°** - Clean Architectureåˆ†å±‚è®¾è®¡
2. **ä»£ç è´¨é‡** - é«˜å†…èšä½è€¦åˆï¼Œæ˜“äºç»´æŠ¤
3. **å¯æ‰©å±•æ€§** - åè®®å¯¼å‘ï¼Œæ”¯æŒåŠŸèƒ½æ‰©å±•
4. **æ€§èƒ½ä¼˜åŒ–** - å†…å­˜ç®¡ç†å’Œæ¸²æŸ“ä¼˜åŒ–
5. **æµ‹è¯•å‹å¥½** - ä¾èµ–æ³¨å…¥æ”¯æŒå•å…ƒæµ‹è¯•

é¡¹ç›®ç°åœ¨å…·å¤‡äº†**ä¼ä¸šçº§åº”ç”¨**çš„ä»£ç è´¨é‡å’Œæ¶æ„è®¾è®¡ï¼Œä¸ºåç»­åŠŸèƒ½æ‰©å±•å’Œå›¢é˜Ÿåä½œå¥ å®šäº†åšå®åŸºç¡€ã€‚